-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.blast_logs (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id bigint NOT NULL,
  group_name text,
  group_id bigint,
  topic_id integer,
  status text,
  error_message text,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT blast_logs_pkey PRIMARY KEY (id),
  CONSTRAINT blast_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.blast_schedules (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id bigint NOT NULL,
  run_hour integer NOT NULL,
  run_minute integer NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  template_id bigint,
  target_group_id bigint,
  sender_phone text,
  status text DEFAULT 'active'::text,
  CONSTRAINT blast_schedules_pkey PRIMARY KEY (id),
  CONSTRAINT blast_schedules_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT blast_schedules_target_group_id_fkey FOREIGN KEY (target_group_id) REFERENCES public.blast_targets(id),
  CONSTRAINT blast_schedules_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.message_templates(id)
);
CREATE TABLE public.blast_targets (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id bigint NOT NULL,
  group_id bigint NOT NULL,
  group_name text,
  topic_ids text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  source_phone text,
  source_name text,
  CONSTRAINT blast_targets_pkey PRIMARY KEY (id),
  CONSTRAINT blast_targets_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.message_templates (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id bigint NOT NULL,
  name text NOT NULL,
  message_text text NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  source_link text,
  source_chat_id bigint,
  source_message_id bigint,
  CONSTRAINT message_templates_pkey PRIMARY KEY (id),
  CONSTRAINT message_templates_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.tele_users (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  owner_id bigint NOT NULL,
  user_id bigint NOT NULL,
  username text,
  first_name text,
  last_interaction timestamp with time zone,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  source_phone text,
  CONSTRAINT tele_users_pkey PRIMARY KEY (id),
  CONSTRAINT tele_users_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES public.users(id)
);
CREATE TABLE public.telegram_accounts (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id bigint NOT NULL,
  phone_number text,
  session_string text,
  is_active boolean DEFAULT true,
  targets text DEFAULT '[]'::text,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  first_name text,
  last_name text,
  username text,
  CONSTRAINT telegram_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT telegram_accounts_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  email text NOT NULL UNIQUE,
  password text NOT NULL,
  is_admin boolean DEFAULT false,
  is_banned boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
