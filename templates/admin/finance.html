{% extends "admin/base.html" %}
{% block title %}Finance Center{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-2xl font-bold text-white">ðŸ’³ Finance Center</h1>
    <p class="text-slate-400 text-sm">Validasi pembayaran masuk dan aktivasi paket user.</p>
</div>

<div class="flex gap-2 mb-6">
    <a href="?status=all" class="px-4 py-2 rounded-lg text-xs font-bold border transition {{ 'bg-indigo-600 text-white border-indigo-600' if current_filter == 'all' else 'bg-slate-800 text-slate-400 border-slate-700 hover:border-slate-500' }}">Semua</a>
    <a href="?status=pending" class="px-4 py-2 rounded-lg text-xs font-bold border transition {{ 'bg-orange-600 text-white border-orange-600' if current_filter == 'pending' else 'bg-slate-800 text-slate-400 border-slate-700 hover:border-slate-500' }}">Pending</a>
    <a href="?status=paid" class="px-4 py-2 rounded-lg text-xs font-bold border transition {{ 'bg-emerald-600 text-white border-emerald-600' if current_filter == 'paid' else 'bg-slate-800 text-slate-400 border-slate-700 hover:border-slate-500' }}">Lunas</a>
</div>

<div class="bg-slate-800/50 rounded-xl border border-slate-700 overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full text-left text-sm text-slate-300">
            <thead class="bg-slate-900/50 text-slate-500 uppercase text-xs font-bold">
                <tr>
                    <th class="px-6 py-4">Tanggal</th>
                    <th class="px-6 py-4">User</th>
                    <th class="px-6 py-4">Paket</th>
                    <th class="px-6 py-4">Nominal</th>
                    <th class="px-6 py-4">Bukti</th>
                    <th class="px-6 py-4">Status</th>
                    <th class="px-6 py-4 text-right">Aksi</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-700/50">
                {% for trx in transactions %}
                <tr class="hover:bg-slate-700/20 transition">
                    <td class="px-6 py-4 text-xs whitespace-nowrap text-slate-500">
                        {{ trx.created_at[:16].replace('T', ' ') }}
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-bold text-white">{{ trx.users.email.split('@')[0] }}</div>
                        <div class="text-xs text-slate-500">{{ trx.users.email }}</div>
                    </td>
                    <td class="px-6 py-4">
                        {% if trx.pricing_variants and trx.pricing_variants.pricing_plans %}
                            <span class="inline-flex items-center px-2 py-1 rounded bg-slate-700 border border-slate-600 text-xs font-bold text-indigo-300">
                                {{ trx.pricing_variants.pricing_plans.display_name }} ({{ trx.pricing_variants.duration_days }}hr)
                            </span>
                        {% else %}
                            <span class="text-xs text-red-400">Unknown Plan</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 font-mono font-bold text-emerald-400">
                        Rp {{ "{:,.0f}".format(trx.amount) }}
                    </td>
                    <td class="px-6 py-4">
                        {% if trx.proof_url %}
                            <a href="{{ trx.proof_url }}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs font-bold flex items-center gap-1">
                                <i class="fa-solid fa-paperclip"></i> Cek
                            </a>
                        {% else %}
                            <span class="text-slate-600 text-xs">-</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% if trx.status == 'pending' %}
                            <span class="bg-orange-500/10 text-orange-400 px-2 py-1 rounded text-[10px] font-bold border border-orange-500/20 animate-pulse">PENDING</span>
                        {% elif trx.status == 'paid' %}
                            <span class="bg-emerald-500/10 text-emerald-400 px-2 py-1 rounded text-[10px] font-bold border border-emerald-500/20">LUNAS</span>
                        {% else %}
                            <span class="bg-red-500/10 text-red-400 px-2 py-1 rounded text-[10px] font-bold border border-red-500/20">{{ trx.status }}</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-right">
                        {% if trx.status == 'pending' %}
                        <div class="flex justify-end gap-2">
                            <a href="/super-admin/finance/approve/{{ trx.id }}" onclick="return confirm('Approve pembayaran ini?')" class="bg-emerald-600 hover:bg-emerald-500 text-white p-1.5 rounded transition shadow-lg shadow-emerald-500/20" title="Approve">
                                <i class="fa-solid fa-check"></i>
                            </a>
                            <button class="bg-red-600 hover:bg-red-500 text-white p-1.5 rounded transition shadow-lg shadow-red-500/20" title="Reject">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="py-12 text-center text-slate-500">Belum ada transaksi masuk.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
